http-port: 7890
socks-port: 7891
redir-port: 7892
tproxy-port: 7893
allow-lan: true
geodata-mode: true
unified-delay: true
mode: rule
log-level: info
ipv6: true
tcp-concurrent: true
geo-auto-update: true
geo-update-interval: 24
geox-url:
  geoip: "https://jsd.onmicrosoft.cn/gh/Loyalsoldier/geoip@release/geoip.dat"
  geosite: "https://jsd.onmicrosoft.cn/gh/Loyalsoldier/v2ray-rules-dat@release/geosite.dat"
  mmdb: "https://jsd.onmicrosoft.cn/gh/Loyalsoldier/geoip@release/Country.mmdb"
find-process-mode: strict
global-client-fingerprint: chrome

sniffer:
  enable: true
  sniffing:
    - tls
    - http

profile:
  store-fake-ip: true
  store-selected: true

external-controller: 127.0.0.1:9090
external-ui: yacd

tun:
  enable: false
  device: Meta
  stack: system #system or gvisor
  dns-hijack:
    - any:53
  # auto-route: true
  # auto-detect-interface: true

dns:
  enable: true
  listen: 0.0.0.0:53
  nameserver-policy:
    "geosite:cn,geoip:cn,private":
      - https://doh.pub/dns-query
      - https://dns.alidns.com/dns-query
  nameserver:
    - tls://8.8.4.4
    - https://1.0.0.1/dns-query

# ç”¨äºDNSæœåŠ¡å™¨å’Œè¿æ¥å»ºç«‹çš„é™æ€ä¸»æœº (å¦‚/etc/hosts) .
hosts:
  'appupdate.189.cn': '127.0.0.1'


# å…æµç™¾åº¦ç›´è¿
baidu: &baidu
  type: http
  port: 443
  headers:
    X-T5-Auth: "683556433"
    Host: 153.3.236.22:443
    User-Agent:
      "okhttp/3.11.0 Dalvik/2.1.0 (Linux; U; Android 13; 2210132C Build/TKQ1.220905.001)
      baiduboxapp/11.0.5.12 (Baidu; P1 11)"


# è¿™é‡Œæ˜¯è®¢é˜…æ›´æ–°å’Œå»¶è¿Ÿæµ‹è¯•ç›¸å…³çš„
p: &p
  type: http
  interval: 86400
  health-check:
    enable: true
    url: https://www.gstatic.com/generate_204
    interval: 300

# url é‡Œå¡«å†™è‡ªå·±çš„è®¢é˜…,åç§°ä¸èƒ½é‡å¤
proxy-providers:
  ç¾¤ä¸»_æ˜Ÿé“¾äº‘:
    <<: *p
    url: "https://proxy-provider-converter-git-main-rainbow609s-projects.vercel.app/api/convert?url=https%3A%2F%2Fstarlinkcloud.org%2Fapi%2Fv1%2Fclient%2Fsubscribe%3Ftoken%3D3244403e59624101e781b9e6b1e954d4&target=clash"
    path: ./proxies/ç¾¤ä¸»_æ˜Ÿé“¾äº‘.yaml

  ç¾¤ä¸»_EF:
    <<: *p
    url: "https://proxy-provider-converter-git-main-rainbow609s-projects.vercel.app/api/convert?url=https%3A%2F%2Fv1.efshop.cc%2Fapi%2Fv1%2Fclient%2Fsubscribe%3Ftoken%3D9d51fb4005748bc6419d07639cb25781&target=clash"
    path: ./proxies/ç¾¤ä¸»_EF.yaml

  ç¾¤ä¸»_å¿«æ¸¸æˆ:
    <<: *p
    # url: "https://sub2.jie-quick.buzz/api/v1/client/subscribe?token=6f51949086b1c27116bb77a5a520d09d&host=m.iqiyi.com"
    url: "https://sub2.jie-quick.buzz/api/v1/client/subscribe?token=6f51949086b1c27116bb77a5a520d09d&sethost=m.iqiyi.com"
    path: ./proxies/ç¾¤ä¸»_å¿«æ¸¸æˆ.yaml

  ç¾¤ä¸»_å…æµéªš:
    <<: *p
    url: "https://api.orangeapi.org/sub?suburl=https%3A%2F%2Fsub.mlsao.top%2Fapi%2Fv1%2Fclient%2Fsubscribe%3Ftoken%3D4c981858904603e85fce6c825c4d6e93&newhost=m.iqiyi.com"
    path: ./proxies/ç¾¤ä¸»_å…æµéªš.yaml

  ç¾¤ä¸»_ä¸‰åˆ†:
    <<: *p
    url: "https://proxy-provider-converter-git-main-rainbow609s-projects.vercel.app/api/convert?url=https%3A%2F%2Fsub.sanfen017.xyz%2Fapi%2Fv1%2Fclient%2Fsubscribe%3Ftoken%3D0b73731d54a0e74695ff0429b4dc2870&target=clash"
    path: ./proxies/ç¾¤ä¸»_ä¸‰åˆ†.yaml

  ç¾¤ä¸»_ä¸‰åˆ†_å…æµ:
    <<: *p
    url: "https://api.orangeapi.org/sub?suburl=https%3A%2F%2Fsub.sanfen017.xyz%2Fapi%2Fv1%2Fclient%2Fsubscribe%3Ftoken%3D0b73731d54a0e74695ff0429b4dc2870&newhost=m.iqiyi.com"
    path: ./proxies/ç¾¤ä¸»_ä¸‰åˆ†.yaml

  å°å†°_EF:
    <<: *p
    url: "https://proxy-provider-converter-git-main-rainbow609s-projects.vercel.app/api/convert?url=https%3A%2F%2Fv1.efshop.cc%2Fapi%2Fv1%2Fclient%2Fsubscribe%3Ftoken%3Dfbfd7afff691851519a1036895689ea0&target=clash"
    path: ./proxies/å°å†°_EF.yaml

  å°å†°_ç™½å«–:
    <<: *p
    url: "https://proxy-provider-converter-git-main-rainbow609s-projects.vercel.app/api/convert?url=https%3A%2F%2Fsub.%E7%99%BD%E5%AB%96%E6%9C%BA%E5%9C%BA.com%2Fapi%2Fv1%2Fclient%2Fsubscribe%3Ftoken%3Df8b23722df1e100e0a23f4bdcbcaefb8&target=clash"
    path: ./proxies/å°å†°_ç™½å«–.yaml

  ç«é”…_ä¸‰åˆ†:
    <<: *p
    url: "https://proxy-provider-converter-git-main-rainbow609s-projects.vercel.app/api/convert?url=https%3A%2F%2Fsub.sanfen017.xyz%2Fapi%2Fv1%2Fclient%2Fsubscribe%3Ftoken%3D1e9b47a85263bbd23ca567903a41f066&target=clash"
    path: ./proxies/ç«é”…_ä¸‰åˆ†.yaml

  è¾¾è¾¾_ä¸‰åˆ†:
    <<: *p
    url: "https://proxy-provider-converter-git-main-rainbow609s-projects.vercel.app/api/convert?url=https%3A%2F%2Fwww.efcloud.bio%2Fapi%2Fv1%2Fclient%2Fsubscribe%3Ftoken%3D9d51fb4005748bc6419d07639cb25781&target=clash"
    path: ./proxies/è¾¾è¾¾_ä¸‰åˆ†.yaml

  # å…±äº«_anaer:
  # # ä¾†è‡ª https://github.com/anaer/Sub
  #   <<: *p
  #   url: "https://proxy-provider-converter-git-main-rainbow609s-projects.vercel.app/api/convert?url=https%3A%2F%2Fcdn.jsdelivr.net%2Fgh%2Fanaer%2FSub%40main%2Fclash.yaml&target=clash"
  #   path: ./proxies/å…±äº«_anaer.yaml

  å…±äº«_ermaozi:
  # ä¾†è‡ª https://github.com/ermaozi/get_subscribe
    <<: *p
    url: "https://www.nite07.com/sub/s/1X53si"
    path: ./proxies/å…±äº«_ermaozi.yaml


# ç”¨äºæ™®é€šçš„è®¢é˜…
use: &use
  use:
    - ç¾¤ä¸»_ä¸‰åˆ†
    - ç¾¤ä¸»_æ˜Ÿé“¾äº‘
    - ç¾¤ä¸»_EF
    - ç¾¤ä¸»_å¿«æ¸¸æˆ
    - ç¾¤ä¸»_å…æµéªš
    - å°å†°_EF
    - å°å†°_ç™½å«–
    - ç«é”…_ä¸‰åˆ†
    - è¾¾è¾¾_ä¸‰åˆ†
    # - å…±äº«_anaer
    - å…±äº«_ermaozi

urltest: &urltest
  type: url-test
  # url: "http://www.gstatic.com/generate_204"
  url: "http://www.apple.com/library/test/success.html"  # æ›¿æ¢æˆè‹¹æœçš„æµ‹é€Ÿ
  interval: 180
  tolerance: 100
  <<: *use

fallback: &fallback
  type: fallback
  # url: "http://www.gstatic.com/generate_204"
  url: "http://www.apple.com/library/test/success.html"  # æ›¿æ¢æˆè‹¹æœçš„æµ‹é€Ÿ
  interval: 180
  tolerance: 100
  <<: *use

select: &select
  type: select
  <<: *use

lobalance: &lobalance
  type: load-balance
  url: "http://www.apple.com/library/test/success.html"
  interval: 300
  strategy: consistent-hashing
  <<: *use
  # strategy:
  #  consistent-hashing åŒä¸€ä¸ªåŸŸåä¸‹ä¼šæŒç»­ä½¿ç”¨åŒä¸€ä¸ªip, é»˜è®¤é€‰æ‹©è¯¥é¡¹ï¼Œé˜²æ­¢é¢‘ç¹è·³ipè¢«ç½‘ç«™ban
  #  round-robin æ¯è®¿é—®ä¸€ä¸ªé“¾æ¥ï¼Œé¡ºåºæ›´æ¢èŠ‚ç‚¹è®¿é—®


# èŠ‚ç‚¹ç»„
proxy-groups:
  - name: ä»£ç†è®¾ç½®
    type: select
    proxies:
      - HK urltest
      - HK fallback
      - HK select
      - HK lobalance
      - TW urltest
      - TW fallback
      - TW select
      - TW lobalance
      - JP urltest
      - JP fallback
      - JP select
      - JP lobalance
      - SG urltest
      - SG fallback
      - SG select
      - SG lobalance
      - US urltest
      - US fallback
      - US select
      - US lobalance
      - Other urltest
      - Other fallback
      - Other select
      - Other lobalance
      - æ‰‹åŠ¨åˆ‡æ¢
      - DIRECT

  - {name: æ‰‹åŠ¨åˆ‡æ¢, type: select, <<: *use, exclude-filter: "å‰©ä½™æµé‡|è·ç¦»ä¸‹æ¬¡é‡ç½®å‰©ä½™|å¥—é¤åˆ°æœŸ|å®˜ç½‘|ç«™å†…è¿”åˆ©|å®¢æˆ·ç«¯"}

  - name: å‰©ä½™æµé‡
    type: select
    <<: *use
    filter: "å‰©ä½™æµé‡|è·ç¦»ä¸‹æ¬¡é‡ç½®å‰©ä½™|å¥—é¤åˆ°æœŸ|å®˜ç½‘"

  - {name: HK urltest, <<: *urltest, filter: "(?i)æ¸¯|hk|hongkong|hong kong"}
  - {name: HK fallback, <<: *fallback, filter: "(?i)æ¸¯|hk|hongkong|hong kong"}
  - {name: HK select, <<: *select, filter: "(?i)æ¸¯|hk|hongkong|hong kong"}
  - {name: HK lobalance, <<: *lobalance, filter: "(?i)æ¸¯|hk|hongkong|hong kong"}

  - {name: TW urltest, <<: *urltest, filter: "(?i)å°|tw|taiwan"}
  - {name: TW fallback, <<: *fallback, filter: "(?i)å°|tw|taiwan"}
  - {name: TW select, <<: *select, filter: "(?i)å°|tw|taiwan"}
  - {name: TW lobalance, <<: *lobalance, filter: "(?i)å°|tw|taiwan"}

  - {name: JP urltest, <<: *urltest, filter: "(?i)æ—¥æœ¬|jp|japan"}
  - {name: JP fallback, <<: *fallback, filter: "(?i)æ—¥æœ¬|jp|japan"}
  - {name: JP select, <<: *select, filter: "(?i)æ—¥æœ¬|jp|japan"}
  - {name: JP lobalance, <<: *lobalance, filter: "(?i)æ—¥æœ¬|jp|japan"}

  - {name: SG urltest, <<: *urltest, filter: "(?i)(æ–°|sg|singapore)"}
  - {name: SG fallback, <<: *fallback, filter: "(?i)(æ–°|sg|singapore)"}
  - {name: SG select, <<: *select, filter: "(?i)(æ–°|sg|singapore)"}
  - {name: SG lobalance, <<: *lobalance, filter: "(?i)(æ–°|sg|singapore)"}

  - {name: US urltest, <<: *urltest, filter: "(?i)ç¾|us|unitedstates|united states"}
  - {name: US fallback, <<: *fallback, filter: "(?i)ç¾|us|unitedstates|united states"}
  - {name: US select, <<: *select, filter: "(?i)ç¾|us|unitedstates|united states"}
  - {name: US lobalance, <<: *lobalance, filter: "(?i)ç¾|us|unitedstates|united states"}

  - {name: Other urltest, <<: *urltest, filter: "(?i)^(?!.*(?:ğŸ‡­ğŸ‡°|ğŸ‡¯ğŸ‡µ|ğŸ‡ºğŸ‡¸|ğŸ‡¸ğŸ‡¬|ğŸ‡¨ğŸ‡³|æ¸¯|hk|hongkong|å°|tw|taiwan|æ—¥|jp|japan|æ–°|sg|singapore|ç¾|us|unitedstates)).*"}
  - {name: Other fallback, <<: *fallback, filter: "(?i)^(?!.*(?:ğŸ‡­ğŸ‡°|ğŸ‡¯ğŸ‡µ|ğŸ‡ºğŸ‡¸|ğŸ‡¸ğŸ‡¬|ğŸ‡¨ğŸ‡³|æ¸¯|hk|hongkong|å°|tw|taiwan|æ—¥|jp|japan|æ–°|sg|singapore|ç¾|us|unitedstates)).*"}
  - {name: Other select, <<: *select, filter: "(?i)^(?!.*(?:ğŸ‡­ğŸ‡°|ğŸ‡¯ğŸ‡µ|ğŸ‡ºğŸ‡¸|ğŸ‡¸ğŸ‡¬|ğŸ‡¨ğŸ‡³|æ¸¯|hk|hongkong|å°|tw|taiwan|æ—¥|jp|japan|æ–°|sg|singapore|ç¾|us|unitedstates)).*"}
  - {name: Other lobalance, <<: *lobalance, filter: "(?i)^(?!.*(?:ğŸ‡­ğŸ‡°|ğŸ‡¯ğŸ‡µ|ğŸ‡ºğŸ‡¸|ğŸ‡¸ğŸ‡¬|ğŸ‡¨ğŸ‡³|æ¸¯|hk|hongkong|å°|tw|taiwan|æ—¥|jp|japan|æ–°|sg|singapore|ç¾|us|unitedstates)).*"}


rule_update: &rule_update
  type: http
  interval: 86400

rule-providers:
  ç§‹é£å¹¿å‘Šè§„åˆ™:
    <<: *rule_update
    behavior: domain
    format: yaml
    path: ./ruleset/AWAvenue-Ads-Rule-Clash.yaml
    url: "https://raw.githubusercontent.com/TG-Twilight/AWAvenue-Ads-Rule/main/Filters/AWAvenue-Ads-Rule-Clash.yaml"

  direct:
    # ç›´è¿åŸŸååˆ—è¡¨
    <<: *rule_update
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/direct.txt"
    path: ./rule_providers/direct.yaml

  private:
    # ç§æœ‰ç½‘ç»œä¸“ç”¨åŸŸååˆ—è¡¨
    <<: *rule_update
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/private.txt"
    path: ./rule_providers/private.yaml

  cncidr:
    # ä¸­å›½å¤§é™† IP åœ°å€åˆ—è¡¨
    <<: *rule_update
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/cncidr.txt"
    path: ./rule_providers/cncidr.yaml

  lancidr:
    # å±€åŸŸç½‘ IP åŠä¿ç•™ IP åœ°å€åˆ—è¡¨
    <<: *rule_update
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/lancidr.txt"
    path: ./rule_providers/lancidr.yaml

  applications:
    # éœ€è¦ç›´è¿çš„å¸¸è§è½¯ä»¶åˆ—è¡¨
    <<: *rule_update
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/applications.txt"
    path: ./rule_providers/applications.yaml


# åˆ†æµè§„åˆ™
rules:
  # å¹¿å‘Šè§„åˆ™
  - AND,(AND,(DST-PORT,443),(NETWORK,UDP)),(NOT,((GEOSITE,cn))),REJECT # ç¦ç”¨quic(ä¸åŒ…æ‹¬å›½å†…)
  - RULE-SET,ç§‹é£å¹¿å‘Šè§„åˆ™,REJECT
  - AND,((PROCESS-NAME,clashMeta),(NETWORK,UDP)),REJECT

  - RULE-SET,applications,DIRECT
  - RULE-SET,cncidr,DIRECT
  - RULE-SET,direct,DIRECT
  - RULE-SET,private,DIRECT
  - RULE-SET,lancidr,DIRECT
  - GEOIP,private,DIRECT

  - GEOSITE,cn,DIRECT
  - GEOIP,CN,DIRECT
  - MATCH,ä»£ç†è®¾ç½®

