port: 7890
socks-port: 7891
allow-lan: true
mode: Rule
log-level: info
external-controller: :9090
dns:
  enable: true
  ipv6: false
  default-nameserver: [114.114.114.114, 223.5.5.5]
  listen: "0.0.0.0:53"
  enhanced-mode: redir-host
  fake-ip-range: 198.18.0.1/16
  use-hosts: true
  nameserver: ["https://doh.pub/dns-query", "https://dns.alidns.com/dns-query"]
  fallback:
    [
      "https://doh.dns.sb/dns-query",
      "https://dns.cloudflare.com/dns-query",
      "https://dns.twnic.tw/dns-query",
      "tls://8.8.4.4:853",
    ]
  fallback-filter: { geoip: true, ipcidr: [240.0.0.0/4, 0.0.0.0/32] }

hosts:
  'appupdate.189.cn': '127.0.0.1'

# å…æµç™¾åº¦ç›´è¿
baidu: &baidu
  type: http
  port: 443
  headers:
    X-T5-Auth: "683556433"
    Host: 153.3.236.22:443
    User-Agent:
      "okhttp/3.11.0 Dalvik/2.1.0 (Linux; U; Android 13; 2210132C Build/TKQ1.220905.001)
      baiduboxapp/11.0.5.12 (Baidu; P1 11)"

p: &p
  type: http
  interval: 86400
  health-check:
    enable: true
    url: https://www.gstatic.com/generate_204
    interval: 300

proxy-providers:
  ç¾¤ä¸»_æ˜Ÿé“¾äº‘:
    <<: *p
    url: "https://www.nite07.com/sub/s/i2tZBl"
    path: ./proxy_providers/ç¾¤ä¸»_æ˜Ÿé“¾äº‘.yaml

  ç¾¤ä¸»_å¿«æ¸¸æˆ:
    <<: *p
    url: "https://www.nite07.com/sub/s/A6SkOd"
    path: ./proxy_providers/ç¾¤ä¸»_å¿«æ¸¸æˆ.yaml

  ç¾¤ä¸»_ä¸‰åˆ†:
    <<: *p
    url: "https://www.nite07.com/sub/s/9p329U"
    path: ./proxy_providers/ç¾¤ä¸»_ä¸‰åˆ†.yaml

  ç¾¤ä¸»_wget:
    <<: *p
    url: "https://www.nite07.com/sub/s/U5VXPD"
    path: ./proxy_providers/ç¾¤ä¸»_wget.yaml
    # wget.moe

  ç¾¤ä¸»_å…»çŒªåœº:
    <<: *p
    url: "https://www.nite07.com/sub/s/3byz1Y"
    path: ./proxy_providers/ç¾¤ä¸»_å…»çŒªåœº.yaml

  å°å†°_ç™½å«–:
    <<: *p
    url: "https://www.nite07.com/sub/s/lOfPFe"
    path: ./proxy_providers/å°å†°_ç™½å«–.yaml

  å°å†°_ä¸‰åˆ†:
    <<: *p
    url: "https://www.nite07.com/sub/s/Wg5ZyU"
    path: ./proxy_providers/å°å†°_ä¸‰åˆ†.yaml

  å…±äº«_ermaozi:
  # ä¾†è‡ª https://github.com/ermaozi/get_subscribe
    <<: *p
    url: "https://www.nite07.com/sub/s/niBNfQ"
    path: ./proxy_providers/å…±äº«_ermaozi.yaml

  å…±äº«_é’“é±¼æ± :
    <<: *p
    url: "https://www.nite07.com/sub/s/zCEEgi"
    path: ./proxy_providers/å…±äº«_é’“é±¼æ± .yaml

  å…±äº«_vxiaov:
  # æ¥è‡ª https://github.com/vxiaov/free_proxy_ss
    <<: *p
    url: "https://www.nite07.com/sub/s/S7nO9n"
    path: ./proxy_providers/å…±äº«_vxiaov.yaml

  å…±äº«_dong:
  # æ¥è‡ª https://github.com/dongyubin/Free-AppleId-Serve
    <<: *p
    url: "https://www.nite07.com/sub/s/MOeOI8"
    path: ./proxy_providers/å…±äº«_dong.yaml


# å¼•å…¥æ‰€æœ‰ä»£ç†é›†åˆï¼Œè¿™æ ·å°±ä¸éœ€è¦ä½¿ç”¨ use äº†
use: &use
  include-all-providers: true

urltest: &urltest
  type: url-test
  # url: "http://www.gstatic.com/generate_204"
  url: "https://www.apple.com/library/test/success.html"  # æ›¿æ¢æˆè‹¹æœçš„æµ‹é€Ÿ
  interval: 180
  tolerance: 100
  <<: *use

fallback: &fallback
  type: fallback
  # url: "http://www.gstatic.com/generate_204"
  url: "https://www.apple.com/library/test/success.html"  # æ›¿æ¢æˆè‹¹æœçš„æµ‹é€Ÿ
  interval: 180
  tolerance: 100
  <<: *use

select: &select
  type: select
  <<: *use

lobalance: &lobalance
  type: load-balance
  url: "https://www.apple.com/library/test/success.html"
  interval: 300
  strategy: consistent-hashing
  <<: *use
  # strategy:
  #  consistent-hashing åŒä¸€ä¸ªåŸŸåä¸‹ä¼šæŒç»­ä½¿ç”¨åŒä¸€ä¸ªip, é»˜è®¤é€‰æ‹©è¯¥é¡¹ï¼Œé˜²æ­¢é¢‘ç¹è·³ipè¢«ç½‘ç«™ban
  #  round-robin æ¯è®¿é—®ä¸€ä¸ªé“¾æ¥ï¼Œé¡ºåºæ›´æ¢èŠ‚ç‚¹è®¿é—®

proxy-groups:
  - name: ä»£ç†è®¾ç½®
    type: select
    proxies:
      - HK urltest
      - HK fallback
      - TW urltest
      - TW fallback
      - JP urltest
      - JP fallback
      - SG urltest
      - SG fallback
      - US urltest
      - US fallback
      - Other urltest
      - Other fallback
      - æ‰‹åŠ¨åˆ‡æ¢
      - DIRECT

  - {name: æ‰‹åŠ¨åˆ‡æ¢, type: select, <<: *use, exclude-filter: "å‰©ä½™æµé‡|è·ç¦»ä¸‹æ¬¡é‡ç½®å‰©ä½™|å¥—é¤åˆ°æœŸ|å®˜ç½‘|ç«™å†…è¿”åˆ©|å®¢æˆ·ç«¯"}

  - {name: å‰©ä½™æµé‡, type: select, <<: *use, filter: "å‰©ä½™æµé‡|è·ç¦»ä¸‹æ¬¡é‡ç½®å‰©ä½™|å¥—é¤åˆ°æœŸ|å®˜ç½‘"}

  - {name: NoAD, type: select, proxies: [REJECT-DROP, PASS]}

  # - {name: AI, type: select, proxies: [US fallback, JP fallback, SG fallback, Other fallback]}

  - {name: HK urltest, <<: *urltest, filter: "(?i)æ¸¯|hk|hongkong|hong kong"}
  - {name: HK fallback, <<: *fallback, filter: "(?i)æ¸¯|hk|hongkong|hong kong"}

  - {name: TW urltest, <<: *urltest, filter: "(?i)å°|tw|taiwan"}
  - {name: TW fallback, <<: *fallback, filter: "(?i)å°|tw|taiwan"}

  - {name: JP urltest, <<: *urltest, filter: "(?i)æ—¥æœ¬|jp|japan"}
  - {name: JP fallback, <<: *fallback, filter: "(?i)æ—¥æœ¬|jp|japan"}

  - {name: SG urltest, <<: *urltest, filter: "(?i)(æ–°|sg|singapore)"}
  - {name: SG fallback, <<: *fallback, filter: "(?i)(æ–°|sg|singapore)"}

  - {name: US urltest, <<: *urltest, filter: "(?i)ç¾|us|unitedstates|united states"}
  - {name: US fallback, <<: *fallback, filter: "(?i)ç¾|us|unitedstates|united states"}

  - {name: Other urltest, <<: *urltest, filter: "(?i)^(?!.*(?:ğŸ‡­ğŸ‡°|ğŸ‡¯ğŸ‡µ|ğŸ‡ºğŸ‡¸|ğŸ‡¸ğŸ‡¬|ğŸ‡¨ğŸ‡³|æ¸¯|hk|hongkong|å°|tw|taiwan|æ—¥|jp|japan|æ–°|sg|singapore|ç¾|us|unitedstates)).*"}
  - {name: Other fallback, <<: *fallback, filter: "(?i)^(?!.*(?:ğŸ‡­ğŸ‡°|ğŸ‡¯ğŸ‡µ|ğŸ‡ºğŸ‡¸|ğŸ‡¸ğŸ‡¬|ğŸ‡¨ğŸ‡³|æ¸¯|hk|hongkong|å°|tw|taiwan|æ—¥|jp|japan|æ–°|sg|singapore|ç¾|us|unitedstates)).*"}


rule_update: &rule_update
  type: http
  interval: 86400

rule-providers:
  AWAvenue:
    <<: *rule_update
    behavior: domain
    format: yaml
    path: ./rule_providers/AWAvenue-Ads-Rule-Clash.yaml
    url: "https://raw.githubusercontent.com/TG-Twilight/AWAvenue-Ads-Rule/main/Filters/AWAvenue-Ads-Rule-Clash.yaml"

  # anti-AD å¹¿å‘Šè§„åˆ™ Clash ç‰ˆæœ¬
  # Githubï¼šhttps://github.com/privacy-protection-tools/anti-AD?tab=readme-ov-file
  antiAD:
    <<: *rule_update
    behavior: domain
    format: yaml
    path: ./rule_providers/antiAD.yaml
    url: "https://anti-ad.net/clash.yaml"

  OpenAI:
    <<: *rule_update
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/OpenAI/OpenAI.yaml"
    path: ./rule_providers/openAI.yaml

  Bing:
    <<: *rule_update
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Bing/Bing.yaml"
    path: ./rule_providers/Bing.yaml

  Gemini:
    <<: *rule_update
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Gemini/Gemini.yaml"
    path: ./rule_providers/Gemini.yaml

  Claude:
    <<: *rule_update
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Claude/Claude.yaml"
    path: ./rule_providers/Claude.yaml

  direct:
    # ç›´è¿åŸŸååˆ—è¡¨
    <<: *rule_update
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/direct.txt"
    path: ./rule_providers/direct.yaml

  private:
    # ç§æœ‰ç½‘ç»œä¸“ç”¨åŸŸååˆ—è¡¨
    <<: *rule_update
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/private.txt"
    path: ./rule_providers/private.yaml

  cncidr:
    # ä¸­å›½å¤§é™† IP åœ°å€åˆ—è¡¨
    <<: *rule_update
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/cncidr.txt"
    path: ./rule_providers/cncidr.yaml

  lancidr:
    # å±€åŸŸç½‘ IP åŠä¿ç•™ IP åœ°å€åˆ—è¡¨
    <<: *rule_update
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/lancidr.txt"
    path: ./rule_providers/lancidr.yaml

  applications:
    # éœ€è¦ç›´è¿çš„å¸¸è§è½¯ä»¶åˆ—è¡¨
    <<: *rule_update
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/applications.txt"
    path: ./rule_providers/applications.yaml

rules:
  # å¹¿å‘Šè§„åˆ™
  - AND,(AND,(DST-PORT,443),(NETWORK,UDP)),(NOT,((GEOSITE,cn))),REJECT-DROP # ç¦ç”¨quic(ä¸åŒ…æ‹¬å›½å†…)
  # - RULE-SET,AWAvenue,NoAD
  # - RULE-SET,antiAD,NoAD
  # - AND,((PROCESS-NAME,clashMeta),(NETWORK,UDP)),REJECT-DROP
  - GEOSITE,private,DIRECT
  - GEOSITE,cn,DIRECT
  - GEOIP,CN,DIRECT

  # - RULE-SET,OpenAI,AI
  # - RULE-SET,Bing,AI
  # - RULE-SET,Gemini,AI
  # - RULE-SET,Claude,AI

  - RULE-SET,applications,DIRECT
  - RULE-SET,direct,DIRECT
  - RULE-SET,lancidr,DIRECT

  - MATCH,ä»£ç†è®¾ç½®