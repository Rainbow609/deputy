port: 7890
socks-port: 7891
allow-lan: true
mode: Rule
log-level: info
external-controller: :9090
dns:
  enable: true
  ipv6: false
  default-nameserver: [114.114.114.114, 223.5.5.5]
  listen: '0.0.0.0:53'
  enhanced-mode: redir-host
  fake-ip-range: 198.18.0.1/16
  use-hosts: true
  # nameserver: ['https://doh.pub/dns-query', 'https://dns.alidns.com/dns-query']
  nameserver: ['https://doh.pub/dns-query', 'https://dns.alidns.com/dns-query']
  fallback: ['https://doh.dns.sb/dns-query', 'https://dns.cloudflare.com/dns-query', 'https://dns.twnic.tw/dns-query', 'tls://8.8.4.4:853']
  fallback-filter: { geoip: true, ipcidr: [240.0.0.0/4, 0.0.0.0/32] }

# é…ç½®å‚è€ƒ https://wiki.metacubex.one/example/#_2

proxies:
#æ­¤å¤„ç”¨æ¥æ”¾æœ¬åœ°å…æµé…ç½®ï¼Œæœ¬åœ°å…æµåªèƒ½å…80/443ç«¯å£çš„TCPï¼Œå…¶ä»–è¿æ¥ï¼ˆåŒ…æ‹¬æ‰€æœ‰udpï¼‰ä¸è¡Œ
  - name: BaiduProxyX
    type: http
    server: cloudnproxy.baidu.com
    port: 443
    headers:
      X-T5-Auth: "683556433"
      Host: "153.3.236.22:443"
  - {"name":"baidu-è‹å·","server":"157.0.148.53","type":"http","port":443,"headers":{"Host":"153.3.236.22:443","X-T5-Auth":683556433}}
  - {"name":"baidu-å—äº¬","server":"153.3.236.22","type":"http","port":443,"headers":{"Host":"153.3.236.22:443","X-T5-Auth":683556433}}
  - {"name":"baidu-ä¿å®š1","server":"110.242.70.68","type":"http","port":443,"headers":{"Host":"153.3.236.22:443","X-T5-Auth":683556433}}
  - {"name":"baidu-ä¿å®š2","server":"110.242.70.69","type":"http","port":443,"headers":{"Host":"153.3.236.22:443","X-T5-Auth":683556433}}
  - {"name":"baidu-å¹¿å·","server":"157.255.78.51","type":"http","port":443,"headers":{"Host":"153.3.236.22:443","X-T5-Auth":683556433}}


# è¿™é‡Œæ˜¯è®¢é˜…æ›´æ–°å’Œå»¶è¿Ÿæµ‹è¯•ç›¸å…³çš„
p: &p {type: http, interval: 86400, health-check: {enable: true, url: https://www.gstatic.com/generate_204, interval: 300}}

# url é‡Œå¡«å†™è‡ªå·±çš„è®¢é˜…,åç§°ä¸èƒ½é‡å¤
proxy-providers:
  provider1:
    <<: *p
    url: "https://starlinkcloud.org/api/v1/client/subscribe?token=3244403e59624101e781b9e6b1e954d4"
    path: ./proxies/ç¾¤ä¸»_æ˜Ÿé“¾äº‘.yaml

  provider2:
    <<: *p
    url: "https://v1.efshop.cc/api/v1/client/subscribe?token=9d51fb4005748bc6419d07639cb25781"
    path: ./proxies/ç¾¤ä¸»_EF.yaml

  provider3:
    <<: *p
    url: "https://v1.efshop.cc/api/v1/client/subscribe?token=fbfd7afff691851519a1036895689ea0"
    path: ./proxies/å°å†°_EF.yaml

  provider4:
    <<: *p
    url: "https://sub.ç™½å«–æœºåœº.com/api/v1/client/subscribe?token=f8b23722df1e100e0a23f4bdcbcaefb8"
    path: ./proxies/å°å†°_ç™½å«–.yaml

  provider5:
    <<: *p
    url: "https://v1.efshop.cc/api/v1/client/subscribe?token=dcde680a8bd36e0bb27de68ee4c208e8"
    path: ./proxies/ç«é”…_EF.yaml

  provider6:
    <<: *p
    url: "https://sub.sanfen017.xyz/api/v1/client/subscribe?token=1e9b47a85263bbd23ca567903a41f066"
    path: ./proxies/ç«é”…_ä¸‰åˆ†.yaml

# ç”¨äºæ·»åŠ ä¸Šé¢çš„è®¢é˜…
use: &use
  use:
  - provider1
  - provider2
  - provider3
  - provider4
  - provider5
  - provider6

urltest: &urltest
  type: url-test
  url: 'http://www.gstatic.com/generate_204'
  interval: 180
  tolerance: 100
  use:
  - provider1
  - provider2
  - provider3
  - provider4
  - provider5
  - provider6

iobalance: &iobalance
  type: load-balance
  url: 'http://www.gstatic.com/generate_204'
  interval: 300
  strategy: consistent-hashing
  use:
  - provider1
  - provider2
  - provider3
  - provider4
  - provider5
  - provider6
  # strategy:
  #  consistent-hashing åŒä¸€ä¸ªåŸŸåä¸‹ä¼šæŒç»­ä½¿ç”¨åŒä¸€ä¸ªip, é»˜è®¤é€‰æ‹©è¯¥é¡¹ï¼Œé˜²æ­¢é¢‘ç¹è·³ipè¢«ç½‘ç«™ban
  #  round-robin æ¯è®¿é—®ä¸€ä¸ªé“¾æ¥ï¼Œé¡ºåºæ›´æ¢èŠ‚ç‚¹è®¿é—®

proxy-groups:
  - name: èŠ‚ç‚¹é€‰æ‹©
    type: select
    proxies:
      - å›½å¤–èŠ‚ç‚¹ urltest
      - æ‰‹åŠ¨åˆ‡æ¢
      - æ•…éšœè½¬ç§»
      - è´Ÿè½½å‡è¡¡
      - CN å°æ¹¾ urltest
      - CN å°æ¹¾ iobalance
      - HK é¦™æ¸¯ urltest
      - HK é¦™æ¸¯ iobalance
      - JP æ—¥æœ¬ urltest
      - JP æ—¥æœ¬ iobalance
      - SG æ–°åŠ å¡ urltest
      - SG æ–°åŠ å¡ iobalance
      - US ç¾å›½ urltest
      - US ç¾å›½ iobalance
      - DIRECT

  - name: æ‰‹åŠ¨åˆ‡æ¢
    type: select
    <<: *use
    exclude-filter: 'å‰©ä½™æµé‡'

  - name: å›½å†…åœ°å€  # é»˜è®¤ä¸ä»£ç†ï¼Œç›´è¿
    type: select
    proxies:
      - DIRECT
      - BaiduProxyX
      - baidu-è‹å·
      - baidu-å—äº¬
      - baidu-ä¿å®š1
      - baidu-ä¿å®š2
      - baidu-å¹¿å·
      - å›½å†…èŠ‚ç‚¹

  - name: å‰©ä½™æµé‡
    type: select
    <<: *use
    filter: 'å‰©ä½™æµé‡'

  - name: å›½å†…èŠ‚ç‚¹
    type: select
    <<: *use
    filter: 'å›½å†…|å››å·|å†…è’™|æ¹–åŒ—|æµ·å—|ä¸Šæµ·|åŒ—äº¬|æ±Ÿè‹|å¹¿ä¸œ|å¹¿å·'

  - name: å›½å¤–èŠ‚ç‚¹ urltest
    <<: *urltest
    # æŠŠå›½å†…çš„æ’é™¤ï¼Œç•™ä¸‹å›½å¤–èŠ‚ç‚¹
    exclude-filter: 'å›½å†…|å››å·|å†…è’™|æ¹–åŒ—|æµ·å—|ä¸Šæµ·|åŒ—äº¬|æ±Ÿè‹|å¹¿ä¸œ|å¹¿å·|å‰©ä½™æµé‡'

  - name: è´Ÿè½½å‡è¡¡
    <<: *iobalance

  - name: æ•…éšœè½¬ç§»
    type: fallback
    url: 'http://www.gstatic.com/generate_204'
    interval: 300
    tolerance: 100
    <<: *use

  # ä¸‹é¢æ˜¯åœ°åŒºåˆ†ç»„
  - name: CN å°æ¹¾ urltest
    <<: *urltest
    filter: '(?i)å°|tw|taiwan'

  - name: CN å°æ¹¾ iobalance
    <<: *iobalance
    filter: '(?i)å°|tw|taiwan'

  - name: HK é¦™æ¸¯ urltest
    <<: *urltest
    filter: '(?i)æ¸¯|hk|hongkong|hong kong'

  - name: HK é¦™æ¸¯ iobalance
    <<: *iobalance
    filter: '(?i)æ¸¯|hk|hongkong|hong kong'

  - name: JP æ—¥æœ¬ urltest
    <<: *urltest
    filter: '(?i)æ—¥æœ¬|jp|japan'

  - name: JP æ—¥æœ¬ iobalance
    <<: *iobalance
    filter: '(?i)æ—¥æœ¬|jp|japan'

  - name: SG æ–°åŠ å¡ urltest
    <<: *urltest
    filter: '(?i)(æ–°|sg|singapore)'

  - name: SG æ–°åŠ å¡ iobalance
    <<: *iobalance
    filter: '(?i)(æ–°|sg|singapore)'

  - name: US ç¾å›½ urltest
    <<: *urltest
    filter: '(?i)ç¾|us|unitedstates|united states'

  - name: US ç¾å›½ iobalance
    <<: *iobalance
    filter: '(?i)ç¾|us|unitedstates|united states'

  - name: å…¶å®ƒåœ°åŒº
    <<: *urltest
    filter: '(?i)^(?!.*(?:ğŸ‡­ğŸ‡°|ğŸ‡¯ğŸ‡µ|ğŸ‡ºğŸ‡¸|ğŸ‡¸ğŸ‡¬|ğŸ‡¨ğŸ‡³|æ¸¯|hk|hongkong|å°|tw|taiwan|æ—¥|jp|japan|æ–°|sg|singapore|ç¾|us|unitedstates)).*'

  - name: å…¶å®ƒåœ°åŒº
    <<: *iobalance
    filter: '(?i)^(?!.*(?:ğŸ‡­ğŸ‡°|ğŸ‡¯ğŸ‡µ|ğŸ‡ºğŸ‡¸|ğŸ‡¸ğŸ‡¬|ğŸ‡¨ğŸ‡³|æ¸¯|hk|hongkong|å°|tw|taiwan|æ—¥|jp|japan|æ–°|sg|singapore|ç¾|us|unitedstates)).*'

rule_update: &rule_update
  type: http
  interval: 86400

rule-providers:
  reject:
    # å¹¿å‘ŠåŸŸååˆ—è¡¨
    <<: *rule_update
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/reject.txt"
    path: ./ruleset/reject.yaml

  icloud:
    # iCloud åŸŸååˆ—è¡¨
    <<: *rule_update
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/icloud.txt"
    path: ./ruleset/icloud.yaml

  apple:
    # Apple åœ¨ä¸­å›½å¤§é™†å¯ç›´è¿çš„åŸŸååˆ—è¡¨
    <<: *rule_update
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/apple.txt"
    path: ./ruleset/apple.yaml

  google:
    # [æ…ç”¨]Google åœ¨ä¸­å›½å¤§é™†å¯ç›´è¿çš„åŸŸååˆ—è¡¨
    <<: *rule_update
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/google.txt"
    path: ./ruleset/google.yaml

  proxy:
    # ä»£ç†åŸŸååˆ—è¡¨
    <<: *rule_update
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/proxy.txt"
    path: ./ruleset/proxy.yaml

  direct:
    # ç›´è¿åŸŸååˆ—è¡¨
    <<: *rule_update
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/direct.txt"
    path: ./ruleset/direct.yaml

  private:
    # ç§æœ‰ç½‘ç»œä¸“ç”¨åŸŸååˆ—è¡¨
    <<: *rule_update
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/private.txt"
    path: ./ruleset/private.yaml

  gfw:
    # GFWList åŸŸååˆ—è¡¨
    <<: *rule_update
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/gfw.txt"
    path: ./ruleset/gfw.yaml

  greatfire:
    # GreatFire åŸŸååˆ—è¡¨
    <<: *rule_update
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/greatfire.txt"
    path: ./ruleset/greatfire.yaml

  tld-not-cn:
    # éä¸­å›½å¤§é™†ä½¿ç”¨çš„é¡¶çº§åŸŸååˆ—è¡¨
    <<: *rule_update
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/tld-not-cn.txt"
    path: ./ruleset/tld-not-cn.yaml

  telegramcidr:
    # Telegram ä½¿ç”¨çš„ IP åœ°å€åˆ—è¡¨
    <<: *rule_update
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/telegramcidr.txt"
    path: ./ruleset/telegramcidr.yaml

  cncidr:
    # ä¸­å›½å¤§é™† IP åœ°å€åˆ—è¡¨
    <<: *rule_update
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/cncidr.txt"
    path: ./ruleset/cncidr.yaml

  lancidr:
    # å±€åŸŸç½‘ IP åŠä¿ç•™ IP åœ°å€åˆ—è¡¨
    <<: *rule_update
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/lancidr.txt"
    path: ./ruleset/lancidr.yaml

  applications:
    # éœ€è¦ç›´è¿çš„å¸¸è§è½¯ä»¶åˆ—è¡¨
    <<: *rule_update
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/applications.txt"
    path: ./ruleset/applications.yaml


rules:
 # è¿™äº›æ˜¯è‡ªå®šä¹‰è§„åˆ™ï¼Œæƒ³è¦çš„å¯ä»¥ç»§ç»­åŠ ã€‚

 - DOMAIN-SUFFIX,cnki.net,å›½å†…åœ°å€
 - DOMAIN-SUFFIX,ieee.org,å›½å†…åœ°å€
 - DOMAIN-SUFFIX,acm.org,å›½å†…åœ°å€
 - DOMAIN-SUFFIX,imgtu.com,å›½å†…åœ°å€
 - DOMAIN-SUFFIX,dpdk.org,å›½å†…åœ°å€
 - DOMAIN-SUFFIX,freenom.com,å›½å†…åœ°å€
 - DOMAIN-SUFFIX,sciencedirect.com,å›½å†…åœ°å€
 - DOMAIN-SUFFIX,springer.com,å›½å†…åœ°å€

 - RULE-SET,applications,å›½å†…åœ°å€

 - DOMAIN,clash.razord.top,å›½å†…åœ°å€
 - DOMAIN,yacd.haishan.me,å›½å†…åœ°å€

 # ä¸‹é¢çš„è§„åˆ™æ˜¯é€šè¿‡ä¸Šé¢çš„rule-provideræ¥ç¡®å®šçš„
 - GEOSITE,category-ads-all,REJECT  # å¹¿å‘Šï¼Œå±è”½
 - GEOSITE,geolocation-cn,å›½å†…åœ°å€
 - GEOSITE,geolocation-!cn,èŠ‚ç‚¹é€‰æ‹©

 - RULE-SET,private,å›½å†…åœ°å€
 # - RULE-SET,reject,REJECT   # å¹¿å‘Šï¼Œå±è”½ã€‚ç§»é™¤çš„åŸå› æ˜¯å› ä¸ºäº¬ä¸œä¹‹ç±»çš„åŠ è½½ä¸å‡ºæ¥å›¾ç‰‡ï¼Œç§»é™¤å°±å¥½äº†ï¼Œæœ‰æ—¶é—´å†æŸ¥æŸ¥æ˜¯å› ä¸ºä»€ä¹ˆåŸå› 
 - RULE-SET,icloud,å›½å†…åœ°å€
 - RULE-SET,apple,å›½å†…åœ°å€
 - RULE-SET,google,èŠ‚ç‚¹é€‰æ‹©
 - RULE-SET,proxy,èŠ‚ç‚¹é€‰æ‹©
 - RULE-SET,direct,å›½å†…åœ°å€
 - RULE-SET,lancidr,å›½å†…åœ°å€
 - RULE-SET,cncidr,å›½å†…åœ°å€
 - RULE-SET,telegramcidr,èŠ‚ç‚¹é€‰æ‹©

 - GEOIP,private,å›½å†…åœ°å€
 - GEOIP,CN,å›½å†…åœ°å€
 - GEOIP,!CN,èŠ‚ç‚¹é€‰æ‹©

 - MATCH,èŠ‚ç‚¹é€‰æ‹© # æ¼ç½‘ä¹‹é±¼